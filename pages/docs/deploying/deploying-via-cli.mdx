import Docs from '../../../components/docs';

<Docs title="Deploying via CLI">

In addition to deploying via the UI, Deviceplane includes deployment features in its [CLI](../../cli). These docs describe how to use the CLI to deploy manually, but the same commands can be used to setup [deployment pipelines](../pipelines).

These docs assume you have the CLI installed and configured. If you haven't done this yet, check out the [CLI](../../cli) docs.

## Deploying releases

The most common use case of using the CLI is to deploy a new release for your application. Deploying a new release is simply passing in a yaml file that specifies the config of the application. The project and application needs to be specified in order to create a new release. The project can be set as environment variable or passed in as a flag.

**Option 1: Using environment variables**

Environment variables can be used to set the access key and project. This is particularly useful for CI systems where secrets can be injected as environment variables.

| Environment Variable    | Value                              |
| ----------------------- | ---------------------------------- |
| `$DEVICEPLANE_ACCESS_KEY`  | User or service account access key |
| `$DEVICEPLANE_PROJECT`     | Project ID or name                 |

```shell
# Environment variables are set for access key and project

$ printenv
DEVICEPLANE_ACCESS_KEY=<ACCESS_KEY>
DEVICEPLANE_PROJECT=<PROJECT>

$ deviceplane deploy <APPLICATION> <APPLICATION_CONFIG_FILE>
```

**Option 2: Passing in options as flags**

If you don't want to set environment variables, the project can also be passed in as a flag. If a flag is set it will override the project environment variable.

```shell
# Set only the access key as an environment variable

$ printenv
DEVICEPLANE_ACCESS_KEY=<ACCESS_KEY>

# Deploy by specifying the project and application in the command

$ deviceplane deploy --project <PROJECT> <APPLICATION> <APPLICATION_CONFIG_FILE>
```

### Environment interpolation

When creating the yaml file for the release, your configuration options can contain environment variables so that the file will be use the variable values from the shell environment running the `deviceplane deploy` command. Environment interpolation is only supported in the CLI and not supported in config file the UI.

During deployment, if there are missing environment variables, the CLI will error out and list which variables are missing.

Only `$VALUE` and `${VALUE}` syntax are supported. Other typical shell syntax options are not supported. If your configuration needs a dollar sign, you must use a `$$` so that it is not attempted to be interpolated.

```yaml
service1:
  image: '$IMAGE_NAME_AND_TAG'
  command: '${COMMAND}'
```

Putting `$$` prevents interpolation from occuring and inserts `$` instead.

```yaml
service1:
  image: '$IMAGE_NAME_AND_TAG'
  command: '${COMMAND}'
  labels:
    key: '$${NOT_INTERPOLATED}'
```

## Editing existing releases

An easy way to update an existing release is to edit it using the CLI. Similar to deploying releases, the project can be set as an environment variable or as a flag.

When running `deviceplane edit`, the CLI pulls up the current config of the application into an editor. After the config is saved and exited, it is **automatically deployed** into the application.

```shell
# Environment variables are set for access key and project

$ printenv
DEVICEPLANE_ACCESS_KEY=<ACCESS_KEY>
DEVICEPLANE_PROJECT=<PROJECT>

$ deviceplane edit <APPLICATION>
```

</Docs>
